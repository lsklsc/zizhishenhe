webpackJsonp([4],{RqiW:function(e,t){},YLvu:function(e,t,a){"use strict";t.a={transData:function(e,t,a,l,o){for(var r=[],s={},i=t,n=a,u=l,c=0,p=0,_=e.length;c<_;c++)s[e[c][i]]=e[c];for(;p<_;p++){var d=e[p],v=s[d[n]];v?(!v[u]&&(v[u]=[]),v[u].push(d)):r.push(d),o&&"1"==d.state&&o.push(d.id)}return r}}},icfI:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("Dd8w"),o=a.n(l),r=a("o5Dg"),s=a("YLvu"),i={data:function(){return{role_type:"",company_id:"",rules:{role_name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],role_status:[{required:!0,message:"请选择角色状态",trigger:"change"}],role_type:[{required:!0,message:"请选择角色权限",trigger:"change"}]},options:[{value:1,name:"管理员"},{value:2,name:"编辑"},{value:3,name:"查看"}],value:[],dialogVisible:!1,title:"",lookDialogVisible:!1,tableData:[],ruleForm:{},status:"",searchData:{role_name:"",role_type:""},pageData:{page:1,page_size:10},total:0,lookObj:{},defaultProps:{value:"nav_id",label:"nav_name",children:"children"},visvitList:[]}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;t.ruleForm.obj_id?t.updataRole():t.addRole()})},addRole:function(){var e=this,t=this.$refs.tree.getCheckedNodes();console.log(t);var a=[];t.forEach(function(e){a.push(e.nav_id),e.parentId&&-1==a.indexOf(e.parentId)&&a.push(e.parentId)}),this.ruleForm.role_group=a.join(","),0!=t.length?r.a.adRole(this.ruleForm).then(function(t){0==t.data.code?(e.$message.success("新增成功!"),e.listData(),e.dialogVisible=!1):e.$message.error(t.data.msg)}):this.$message.error("请先为该角色分配菜单")},updataRole:function(){var e=this,t=this.$refs.tree.getCheckedNodes(),a=[];t.forEach(function(e){a.push(e.nav_id),e.parentId&&-1==a.indexOf(e.parentId)&&a.push(e.parentId)}),this.ruleForm.role_group=a.join(","),0!=t.length?r.a.upRole(this.ruleForm.obj_id,this.ruleForm).then(function(t){0==t.data.code?(e.$message.success("编辑成功!"),e.listData(),e.dialogVisible=!1):e.$message.error(t.data.msg)}):this.$message.error("请先为该角色分配菜单")},handleClose:function(e){this.$refs.ruleForm.resetFields(),this.ruleForm={}},updataClick:function(e){var t=this;this.title="编辑角色",this.ruleForm=o()({},e);var a=e.role_group.split(",");this.$nextTick(function(){t.$refs.tree.setCheckedKeys(a)}),this.dialogVisible=!0},addAccount:function(){this.ruleForm.company_uid=this.company_id,this.title="添加角色",this.dialogVisible=!0},lookClick:function(e){console.log(e),this.lookObj=o()({},e),this.lookDialogVisible=!0},switchClick:function(e){var t=this,a={role_status:e.role_status};r.a.updataRoleStatus(e.obj_id,a).then(function(a){1==e.role_status?t.$message.success("已启用!"):t.$message.info("已禁用!"),t.listData()})},deleteRoleClick:function(e){var t=this;console.log(e),this.$confirm("确认删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){r.a.deleteRole(e.obj_id).then(function(e){204==e.data.code?(t.$message.success("删除成功!"),t.listData()):t.$message.error(e.data.msg)})}).catch(function(){t.$message.info("已取消删除")})},clearCartList:function(){this.lookObj={}},handleSizeChange:function(e){this.pageData.page_size=e,this.listData()},handleCurrentChange:function(e){this.pageData.page=e,this.listData()},searchClk:function(){this.pageData.page=1,this.listData()},resetClk:function(){this.pageData.page=1,this.pageData.page_size=10,this.searchData={},this.listData()},listData:function(){var e=this,t=o()({company_uid:this.company_id,page:this.pageData.page,size:this.pageData.page_size},this.searchData);r.a.roleData(t).then(function(t){200==t.status&&(e.tableData=t.data.data.data.results,e.total=t.data.data.data.count)})},getVisvitList:function(){var e=this;r.a.visvitPageList().then(function(t){200==t.status&&(e.visvitList=s.a.transData(t.data.data,"nav_id","pid","children"),console.log(e.visvitList))})}},mounted:function(){this.role_type=JSON.parse(localStorage.getItem("userInfo")).role_type,this.company_id=JSON.parse(localStorage.getItem("userInfo")).company_id,this.ruleForm.company_uid=JSON.parse(localStorage.getItem("userInfo")).company_id,this.listData(),this.getVisvitList()}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{},[a("el-form",{attrs:{inline:""}},[a("el-form-item",{attrs:{label:"角色名称："}},[a("el-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.searchData.role_name,callback:function(t){e.$set(e.searchData,"role_name",t)},expression:"searchData.role_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色权限："}},[a("el-select",{attrs:{placeholder:"全部"},model:{value:e.searchData.role_type,callback:function(t){e.$set(e.searchData,"role_type",t)},expression:"searchData.role_type"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})],2)],1),e._v(" "),"1"==e.role_type||"2"==e.role_type?a("el-button",{attrs:{type:"primary"},on:{click:e.addAccount}},[e._v("新增")]):e._e(),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.searchClk}},[e._v("搜索")]),e._v(" "),a("el-button",{staticClass:"margin",attrs:{type:"warning"},on:{click:e.resetClk}},[e._v("重置")])],1),e._v(" "),a("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",border:"",height:"73vh"}},[a("el-table-column",{attrs:{type:"index",label:"序号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"role_name",label:"角色名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"role_name",label:"角色权限"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.role_type?a("span",[e._v("管理员")]):e._e(),e._v(" "),2==t.row.role_type?a("span",[e._v("编辑")]):e._e(),e._v(" "),3==t.row.role_type?a("span",[e._v("查看")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"role_content",label:"角色说明"}}),e._v(" "),a("el-table-column",{attrs:{prop:"contacts",label:"角色状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(a){return e.switchClick(t.row)}},model:{value:t.row.role_status,callback:function(a){e.$set(t.row,"role_status",a)},expression:"scope.row.role_status"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.lookClick(t.row)}}},[e._v("查看")]),e._v(" "),"1"==e.role_type||"2"==e.role_type?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.updataClick(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),"1"==e.role_type?a("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(a){return e.deleteRoleClick(t.row)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:function(t){return e.handleClose("ruleForm")}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"角色名称：",prop:"role_name"}},[a("el-input",{model:{value:e.ruleForm.role_name,callback:function(t){e.$set(e.ruleForm,"role_name",t)},expression:"ruleForm.role_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色权限：",prop:"role_type"}},[a("el-select",{attrs:{placeholder:"请选择角色"},model:{value:e.ruleForm.role_type,callback:function(t){e.$set(e.ruleForm,"role_type",t)},expression:"ruleForm.role_type"}},e._l(e.options,function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"角色说明："}},[a("el-input",{model:{value:e.ruleForm.role_content,callback:function(t){e.$set(e.ruleForm,"role_content",t)},expression:"ruleForm.role_content"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色状态：",prop:"role_status"}},[a("el-radio-group",{model:{value:e.ruleForm.role_status,callback:function(t){e.$set(e.ruleForm,"role_status",t)},expression:"ruleForm.role_status"}},[a("el-radio",{attrs:{label:1}},[e._v("启用")]),e._v(" "),a("el-radio",{attrs:{label:0}},[e._v("禁用")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"访问页面："}},[a("el-tree",{ref:"tree",attrs:{data:e.visvitList,props:e.defaultProps,"show-checkbox":"","default-expand-all":!1,"node-key":"nav_id"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("确定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"查看",visible:e.lookDialogVisible,width:"50%"},on:{"update:visible":function(t){e.lookDialogVisible=t},close:e.clearCartList}},[a("el-row",[a("el-col",[e._v("角色名称："+e._s(e.lookObj.role_name))])],1),e._v(" "),a("el-row",[a("el-col",[e._v("角色权限：\n        "),"1"==e.lookObj.role_type?a("span",[e._v("管理员")]):e._e(),e._v(" "),"2"==e.lookObj.role_type?a("span",[e._v("编辑")]):e._e(),e._v(" "),"3"==e.lookObj.role_type?a("span",[e._v("查看")]):e._e()])],1),e._v(" "),a("el-row",[a("el-col",[e._v("\n        角色状态：\n        "),"1"==e.lookObj.role_status?a("span",[e._v(" 启用")]):e._e(),e._v(" "),"0"==e.lookObj.role_status?a("span",[e._v(" 禁用")]):e._e()])],1),e._v(" "),a("div",{staticClass:"group_name"},[a("span",[e._v("访问页面：")]),e._v(" "),e._l(e.lookObj.group_name,function(t,l){return a("span",{key:l,staticClass:"span"},[e._v(e._s(t+" / "))])})],2),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.lookDialogVisible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),a("div",{staticClass:"fenye"},[a("el-pagination",{attrs:{"current-page":e.pageData.page,"page-size":e.pageData.page_size,"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var u=a("VU/8")(i,n,!1,function(e){a("RqiW")},"data-v-295709d8",null);t.default=u.exports}});
//# sourceMappingURL=4.2f3ec868493b3ef5a9af.js.map