webpackJsonp([13],{TVyp:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Gu7T"),l=a.n(i),r=a("mvHQ"),s=a.n(r),o=a("Dd8w"),n=a.n(o),c=a("hYS1"),u=a("F+jZ"),d=a("o5Dg"),m=a("mtWM"),p=a.n(m),_={components:{upload:c.a},data:function(){return{role_type:"",company_id:"",pickerOptions1:{disabledDate:function(t){var e=(new Date).getFullYear(),a=(new Date).getMonth(),i=(new Date).getDate(),l=new Date(e,a,i,"23","59","59").getTime();return t.getTime()>l}},rules:{name:[{required:!0,message:"请输入合同名称",trigger:"blur"}],certificate_number:[{required:!0,message:"请输入证书编号",trigger:"blur"}],licensed_content:[{required:!0,message:"请填写许可内容",trigger:"blur"}],licence_place:[{required:!0,message:"请填写发证机关",trigger:"blur"}],signed_time:[{required:!0,message:"请选择证书备案日期",trigger:"blur"}],viald_time:[{required:!0,message:"请选择证书有效期",trigger:"blur"}],service_area:[{required:!0,message:"请选择服务区域",trigger:"blur"}]},selectList:[],dialogVisible:!1,dialogVisible1:!1,imgDialogVisible:!1,dialogTitle:"",pickerOptions:{disabledDate:function(t){return t.getTime()>new Date(new Date((new Date).toLocaleDateString()).getTime()+864e5-1)}},pickerOptions0:{disabledDate:function(t){return t.getTime()<Date.now()-864e5}},ruleForm:{},tableData:[],options:[{value:"0",label:"未审核"},{value:"1",label:"审核通过"},{value:"2",label:"审核失败"},{value:"3",label:"已注销"}],status:"",searchData:{contractVal:""},date1:[],date2:[],date3:[],pageData:{page:1,page_size:10},total:0,activeParams:"0",isYi:!0,isCause:!1,isButton0:!0,isButton1:!0,isButton2:!0,isButton3:!0,no_reject:!1,licensed_content:!1,caozuo:!0,title:"保存日期：",lookObj:{},baseUrl:"",recordList:[],oldruleForm:{},imgList:[],serviceList:[]}},methods:{httpRequest:function(t){var e=this,a=new FormData,i=localStorage.getItem("token");a.append("file",t.file),a.append("company_id",this.company_id),p.a.post(u.a+"/qualification/quali_push/",a,{headers:{"Content-Type":"multipart/form-data",Authorization:"Token "+i}}).then(function(t){200==t.data.code?(e.$message.success(t.data.msg),e.certificationList()):208==t.data.code?e.$message.warning(t.data.msg):e.$message.error(t.data.msg)})},exportTable:function(){var t=this;this.$confirm("本次共导出"+this.total+"条数据是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e={data:n()({company_id:t.company_id,page:t.pageData.page,size:t.pageData.page_size},t.searchData,{start_create_time:t.date1[0],end_create_time:t.date1[1],start_enter_time:t.date3[0],end_enter_time:t.date3[1],start_submit_time:t.date2[0],end_submit_time:t.date2[1],status:t.activeParams}),api:"certificationData",total:t.total};t.$refs.export.exportlist(e)}).catch(function(){t.$message({type:"info",message:"已取消导出"})})},importClick:function(){var t=document.createElement("a");t.style.display="none",t.href="http://filemanager.ztbory.com/v1/file/filedownload/?bucket=qualification&path=20210302&filename=93e7eeb535bb4661b3d78f2ff5a32d0b.xlsx",t.setAttribute("download","资质模板"),document.body.appendChild(t),console.log(t),t.click()},tabClick:function(t){"0"===t.name&&(this.isYi=!0,this.isCause=!1,this.isButton0=!0,this.isButton1=!0,this.isButton2=!0,this.isButton3=!0,this.licensed_content=!1,this.no_reject=!1,this.caozuo=!0,this.title="保存日期：",this.certificationList()),"1"===t.name&&(this.isYi=!0,this.isCause=!1,this.isButton0=!0,this.isButton1=!1,this.isButton2=!1,this.isButton3=!1,this.licensed_content=!0,this.caozuo=!1,this.no_reject=!1,this.title="提交日期：",this.certificationList()),"2"===t.name&&(this.isYi=!1,this.isCause=!0,this.isButton0=!0,this.isButton1=!1,this.isButton2=!0,this.isButton3=!0,this.licensed_content=!1,this.caozuo=!1,this.no_reject=!0,this.title="审核日期：",this.certificationList()),"3"===t.name&&(this.isYi=!0,this.isCause=!1,this.isButton0=!0,this.isButton1=!1,this.isButton2=!0,this.isButton3=!0,this.licensed_content=!0,this.no_reject=!1,this.caozuo=!1,this.title="通过日期：",this.certificationList())},submitClick:function(t){var e=this;t.qualification_picture?this.$confirm("确认提交, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={status:1,qualificate_id:t.qualificate_id,company_id:e.company_id};d.a.submitCertification(t.id,a).then(function(t){0==t.data.code?(e.$message.success("提交成功!"),e.certificationList()):e.$message.error(t.data.msg)})}).catch(function(){e.$message.info("已取消提交")}):this.$message.warning("请完善资质信息")},submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(e.ruleForm.qualification_picture){if(!t)return console.log("error submit!!"),!1;if(e.ruleForm.id){console.log(e.ruleForm,11);var a={status:e.ruleForm.status,qualificate_id:e.ruleForm.qualificate_id};for(var i in e.ruleForm)for(var l in e.oldruleForm)i==l&&e.ruleForm[i]!=e.oldruleForm[l]&&(console.log(i),a[i]=e.ruleForm[i]);a.viald_time=s()(a.viald_time),d.a.updataCertification(e.ruleForm.id,a).then(function(t){0==t.data.code?(e.$message.success("编辑成功!"),e.certificationList(),e.dialogVisible1=!1):e.$message.error(t.data.msg)})}else{var r=n()({},e.ruleForm);r.viald_time=s()(r.viald_time),d.a.addCertification(r).then(function(t){0==t.data.code?(e.$message.success("新增成功!"),e.certificationList(),e.dialogVisible1=!1):e.$message.error(t.data.msg)})}}else e.$message.warning("请上传资质照片")})},handleClose:function(t){this.$refs.ruleForm.resetFields(),this.$refs.upload.clearFiles()},addClk:function(){this.dialogTitle="新建",this.dialogVisible1=!0,this.imageUrl=""},updataClick:function(t){console.log(t),this.dialogTitle="修改",this.dialogVisible1=!0,this.imageUrl=this.baseUrl+"/"+t.qualification_picture,this.oldruleForm=n()({},t),this.ruleForm=n()({},t)},deleteClick:function(t){var e=this;console.log(t);var a={status:t.status,qualificate_id:t.qualificate_id};this.$confirm("此操作将永久删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){d.a.delCertification(t.id,a).then(function(t){e.$message.success("删除成功!"),e.certificationList()})}).catch(function(){e.$message.info("已取消删除")})},lookClick:function(t){var e=this;this.lookObj=t,this.imgList=[].concat(l()((t.qualification_picture||"").split(","))),this.dialogVisible=!0;var a={status:t.status,qualificate_id:t.qualificate_id};d.a.recordCertification(a).then(function(t){console.log(t),0==t.data.code&&(e.recordList=t.data.data)})},handleSizeChange:function(t){this.pageData.page_size=t,this.certificationList()},handleCurrentChange:function(t){this.pageData.page=t,this.certificationList()},uploadSuccess:function(t){this.ruleForm.qualification_picture=t.join(",")},lookImgClick:function(t){this.imgDialogVisible=!0,this.imgList=[].concat(l()((t.qualification_picture||"").split(",")))},searchClk:function(){this.pageData.page=1,this.certificationList()},resetClk:function(){this.pageData.page=1,this.pageData.page_size=10,this.date1=[],this.date2=[],this.date3=[],this.status="",this.searchData={},this.certificationList()},certificationList:function(){var t=this,e=n()({company_id:this.company_id,page:this.pageData.page,size:this.pageData.page_size},this.searchData,{start_create_time:this.date1[0],end_create_time:this.date1[1],start_enter_time:this.date3[0],end_enter_time:this.date3[1],start_submit_time:this.date2[0],end_submit_time:this.date2[1],status:this.activeParams});d.a.certificationData(e).then(function(e){200==e.data.code&&(t.tableData=e.data.data.data.results,t.total=e.data.data.data.count)})},serviceData:function(){var t=this,e={company_id:this.company_id};d.a.quCheZizhiData(e).then(function(e){0==e.data.code&&(t.serviceList=e.data.data.data)})}},mounted:function(){var t=localStorage.getItem("userInfo"),e=JSON.parse(t);this.ruleForm.company_id=e.company_id,this.company_id=e.company_id,this.role_type=e.role_type,this.baseUrl=u.a,this.certificationList(),this.serviceData()}},f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[a("el-tabs",{on:{"tab-click":t.tabClick},model:{value:t.activeParams,callback:function(e){t.activeParams=e},expression:"activeParams"}},[a("el-tab-pane",{attrs:{label:"草稿",name:"0"}}),t._v(" "),a("el-tab-pane",{attrs:{label:"待处理",name:"1"}}),t._v(" "),a("el-tab-pane",{attrs:{label:"不通过",name:"2"}}),t._v(" "),a("el-tab-pane",{attrs:{label:"已通过",name:"3"}})],1),t._v(" "),a("el-form",{attrs:{inline:""}},[a("el-form-item",{attrs:{label:"资质名称："}},[a("el-input",{attrs:{placeholder:"请输入资质名称"},model:{value:t.searchData.name,callback:function(e){t.$set(t.searchData,"name",e)},expression:"searchData.name"}})],1),t._v(" "),"0"==t.activeParams?a("el-form-item",{attrs:{label:"保存日期"}},[a("el-date-picker",{attrs:{type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"picker-options":t.pickerOptions1,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.date1,callback:function(e){t.date1=e},expression:"date1"}})],1):t._e(),t._v(" "),"1"==t.activeParams?a("el-form-item",{attrs:{label:"提交日期"}},[a("el-date-picker",{attrs:{type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"picker-options":t.pickerOptions1,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.date2,callback:function(e){t.date2=e},expression:"date2"}})],1):t._e(),t._v(" "),"2"==t.activeParams?a("el-form-item",{attrs:{label:"审核日期"}},[a("el-date-picker",{attrs:{type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"picker-options":t.pickerOptions1,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.date3,callback:function(e){t.date3=e},expression:"date3"}})],1):t._e(),t._v(" "),"3"==t.activeParams?a("el-form-item",{attrs:{label:"通过日期"}},[a("el-date-picker",{attrs:{type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"picker-options":t.pickerOptions1,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.date3,callback:function(e){t.date3=e},expression:"date3"}})],1):t._e(),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.searchClk}},[t._v("搜索")]),t._v(" "),"0"!=t.activeParams||"1"!=t.role_type&&"2"!=t.role_type?t._e():a("el-button",{attrs:{type:"primary"},on:{click:t.addClk}},[t._v("新建")]),t._v(" "),a("el-button",{staticClass:"margin",attrs:{type:"warning"},on:{click:t.resetClk}},[t._v("重置")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.exportTable}},[t._v("导出")]),t._v(" "),a("dataExport",{ref:"export",attrs:{filename:"资质管理",data:t.tableData}}),t._v(" "),"0"==t.activeParams?a("el-form-item",[a("el-upload",{attrs:{accept:".xls, .xlsx",action:"string","http-request":t.httpRequest}},[a("el-button",{attrs:{type:"primary"}},[t._v("导入")])],1)],1):t._e(),t._v(" "),"0"==t.activeParams?a("el-form-item",[a("el-button",{attrs:{type:"success"},on:{click:t.importClick}},[t._v("下载导入模板")])],1):t._e()],1),t._v(" "),a("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"",border:"",height:"67vh"}},[a("el-table-column",{attrs:{type:"index",label:"序号"}}),t._v(" "),"3"==t.activeParams?a("el-table-column",{attrs:{prop:"enter_time",label:"通过时间"}}):t._e(),t._v(" "),"0"==t.activeParams?a("el-table-column",{attrs:{prop:"create_time",label:"保存时间"}}):t._e(),t._v(" "),"1"==t.activeParams?a("el-table-column",{attrs:{prop:"submit_time",label:"提交时间"}}):t._e(),t._v(" "),"2"==t.activeParams?a("el-table-column",{attrs:{prop:"enter_time",label:"审核时间"}}):t._e(),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"资质名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"signed_time",label:"证书备案日期"}}),t._v(" "),a("el-table-column",{attrs:{prop:"viald_time",label:"证书有效期"}}),t._v(" "),t.licensed_content?a("el-table-column",{attrs:{prop:"licensed_content",label:"许可内容"}}):t._e(),t._v(" "),t.no_reject?a("el-table-column",{attrs:{prop:"no_reject",label:"不通过原因"}}):t._e(),t._v(" "),a("el-table-column",{attrs:{prop:"contacts",label:"资质图片"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.lookImgClick(e.row)}}},[t._v("查看")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"200px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[!t.isButton0||"1"!=t.role_type&&"2"!=t.role_type&&"3"!=t.role_type?t._e():a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.lookClick(e.row)}}},[t._v("查看")]),t._v(" "),!t.isButton1||"1"!=t.role_type&&"2"!=t.role_type?t._e():a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.submitClick(e.row)}}},[t._v("提交")]),t._v(" "),!t.isButton2||"1"!=t.role_type&&"2"!=t.role_type?t._e():a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.updataClick(e.row)}}},[t._v("修改")]),t._v(" "),t.isButton3&&"1"==t.role_type?a("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(a){return t.deleteClick(e.row)}}},[t._v("删除")]):t._e()]}}])})],1),t._v(" "),a("el-dialog",{attrs:{title:t.dialogTitle,visible:t.dialogVisible1,"close-on-click-modal":!1,width:"50%"},on:{"update:visible":function(e){t.dialogVisible1=e},close:function(e){return t.handleClose("ruleForm")}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"160px"}},[a("el-form-item",{attrs:{label:"资质名称：",prop:"name"}},[a("el-input",{attrs:{width:"200px"},model:{value:t.ruleForm.name,callback:function(e){t.$set(t.ruleForm,"name",e)},expression:"ruleForm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"服务区域：",prop:"service_area"}},[a("el-select",{attrs:{placeholder:"请选择服务区域"},model:{value:t.ruleForm.service_area,callback:function(e){t.$set(t.ruleForm,"service_area",e)},expression:"ruleForm.service_area"}},t._l(t.serviceList,function(t){return a("el-option",{key:t.coding,attrs:{label:t.name,value:t.coding}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"证书备案日期：",prop:"signed_time"}},[a("el-date-picker",{attrs:{"picker-options":t.pickerOptions0,type:"date","value-format":"yyyy-MM-dd",placeholder:"请选择证书备案日期"},model:{value:t.ruleForm.signed_time,callback:function(e){t.$set(t.ruleForm,"signed_time",e)},expression:"ruleForm.signed_time"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"证书有效期：",prop:"viald_time"}},[a("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",placeholder:"请选择证书有效期"},model:{value:t.ruleForm.viald_time,callback:function(e){t.$set(t.ruleForm,"viald_time",e)},expression:"ruleForm.viald_time"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"证书编号：",prop:"certificate_number"}},[a("el-input",{model:{value:t.ruleForm.certificate_number,callback:function(e){t.$set(t.ruleForm,"certificate_number",e)},expression:"ruleForm.certificate_number"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"许可内容：",prop:"licensed_content"}},[a("el-input",{model:{value:t.ruleForm.licensed_content,callback:function(e){t.$set(t.ruleForm,"licensed_content",e)},expression:"ruleForm.licensed_content"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"发证机关：",prop:"licence_place"}},[a("el-input",{model:{value:t.ruleForm.licence_place,callback:function(e){t.$set(t.ruleForm,"licence_place",e)},expression:"ruleForm.licence_place"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"资质照片：",prop:"qualification_picture"}},[a("upload",{ref:"upload",attrs:{imageUrl:t.ruleForm.qualification_picture},on:{uploadSuccess:t.uploadSuccess}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible1=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("ruleForm")}}},[t._v("确定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"详情",visible:t.dialogVisible,width:"50%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[t._v("资质名称："+t._s(t.lookObj.name))]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("证书备案日期："+t._s(t.lookObj.signed_time))])],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[t._v("证书有效期："+t._s(t.lookObj.viald_time))]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("证书编号："+t._s(t.lookObj.certificate_number))])],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[t._v("许可内容："+t._s(t.lookObj.licensed_content))]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("发证机关："+t._s(t.lookObj.licence_place))])],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[t._v("\n        资质照片：\n        "),t._l(t.imgList,function(e){return a("el-image",{key:e,staticStyle:{width:"100px",height:"100px"},attrs:{src:e,"preview-src-list":t.imgList}},[a("div",{staticStyle:{"line-height":"100px"},attrs:{slot:"error"},slot:"error"},[t._v("\n            暂无图片\n          ")])])})],2)],1),t._v(" "),"2"==t.activeParams||"3"==t.activeParams?a("div",{staticClass:"recordTable"},[a("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:t.recordList,stripe:"",border:"",height:"26vh"}},[a("el-table-column",{attrs:{type:"index",label:"序号"}}),t._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"时间"}}),t._v(" "),a("el-table-column",{attrs:{prop:"username",label:"修改人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"update_data",label:"修改项"}}),t._v(" "),a("el-table-column",{attrs:{prop:"old_content",label:"修改前"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.old_content.indexOf("http")>-1?a("div",{staticStyle:{display:"flex"}},t._l(e.row.old_content.split(","),function(t,i){return a("div",{key:i},[a("el-image",{staticStyle:{width:"50px",height:"50px"},attrs:{src:t,"preview-src-list":e.row.old_content.split(",")}})],1)}),0):a("div",[t._v(t._s(e.row.old_content))])]}}],null,!1,2285074851)}),t._v(" "),a("el-table-column",{attrs:{prop:"new_content",label:"修改后"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.new_content.indexOf("http")>-1?a("div",{staticStyle:{display:"flex"}},t._l(e.row.new_content.split(","),function(t,i){return a("div",{key:i},[a("el-image",{staticStyle:{width:"50px",height:"50px"},attrs:{src:t,"preview-src-list":e.row.new_content.split(",")}})],1)}),0):a("div",[t._v(t._s(e.row.new_content))])]}}],null,!1,1125431811)})],1)],1):t._e(),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"资质照片",visible:t.imgDialogVisible,width:"50%"},on:{"update:visible":function(e){t.imgDialogVisible=e}}},[t._l(t.imgList,function(e){return a("el-image",{key:e,staticStyle:{width:"100px",height:"100px"},attrs:{src:e,"preview-src-list":t.imgList}},[a("div",{staticStyle:{"line-height":"100px"},attrs:{slot:"error"},slot:"error"},[t._v("\n        暂无图片\n      ")])])}),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.imgDialogVisible=!1}}},[t._v("取 消")])],1)],2),t._v(" "),a("div",{staticClass:"fenye"},[a("el-pagination",{attrs:{"current-page":t.pageData.page,"page-size":t.pageData.page_size,"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var h=a("VU/8")(_,f,!1,function(t){a("gWWc")},"data-v-069714cc",null);e.default=h.exports},gWWc:function(t,e){}});
//# sourceMappingURL=13.3a39ed5434178dfa8ffb.js.map